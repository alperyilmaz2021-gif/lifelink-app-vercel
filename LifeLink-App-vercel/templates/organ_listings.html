{% extends "_base.html" %}{% block content %}
<div class="container section">
  <h2 class="h2">Organ Listings</h2>
  <p class="sub">Search and filter organs across registered hospitals. Priority status and availability are tracked separately.</p>
  <form class="searchbar" method="get">
    <input class="input" name="q" value="{{ request.args.get('q','') }}" placeholder="Search by organ type, blood type, or location..." />
    <button class="btn" type="submit">Search</button>
  </form>
  <div class="filters" style="margin:12px 0 18px;display:flex;flex-wrap:wrap;gap:8px;align-items:center">
    <div>
      {% for t in ['All','Heart','Liver','Kidney','Lung','Cornea','Pancreas'] %}
        <a class="chip {% if (request.args.get('type','All')==t) %}active{% endif %}"
           href="{{ url_for('organ_listings', q=request.args.get('q',''), type=t, availability=request.args.get('availability','All')) }}">{{ t }}</a>
      {% endfor %}
    </div>
    <div style="margin-left:auto">
      <span class="small" style="margin-right:4px">Availability:</span>
      {% for a in ['All','Available','Unavailable'] %}
        <a class="chip {% if (request.args.get('availability','All')==a) %}active{% endif %}"
           href="{{ url_for('organ_listings', q=request.args.get('q',''), type=request.args.get('type','All'), availability=a) }}">{{ a }}</a>
      {% endfor %}
    </div>
  </div>
  {% if organs %}
    <div class="grid" style="grid-template-columns:1fr">
      {% for o in organs %}
        <div class="card">
          <div class="row">
            <div>
              <div class="pill">{{ o.organ_type }}</div>
              <h3 style="margin:4px 0 2px">{{ o.hospital_name }}</h3>
              <div class="small">{{ o.city }}, {{ o.state }}</div>
              <div class="small">Blood type: <b>{{ o.blood_type }}</b></div>
              <div class="small">Donor age: {{ o.age }} years Â· Weight: {{ "%.1f"|format(o.weight_kg or 0) }} kg</div>
            </div>
            <div class="small" style="text-align:right">
              <div>Priority: <b>{{ o.priority_status or 'Normal' }}</b></div>
              <div>Availability: 
                {% if o.availability_status == 'Available' %}
                  <b style="color:#28a745">Available</b>
                {% else %}
                  <b style="color:#e55353">Unavailable</b>
                {% endif %}
              </div>
              <div class="small" style="margin-top:4px">Created: {{ o.created_at }}</div>
            </div>
          </div>
          <div style="margin-top:10px;display:flex;justify-content:flex-end">
            {% if o.availability_status == 'Available' %}
              <a class="btn primary" href="{{ url_for('request_transport', listing_id=o['id']) }}">Request Transport</a>
            {% else %}
              <button class="btn" type="button" disabled>Not Available</button>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="notice">No specimens found for the current filters.</div>
  {% endif %}
  <div class="notice" style="margin-top:18px">
    <b>Emergency Transport Available</b>
    <div class="small">Priority routing and specialized vehicles for critical cases.</div>
    <div style="margin-top:8px"><a class="btn emergency" href="{{ url_for('emergency_transport') }}">Request Emergency Transport</a></div>
  </div>
</div>
{% endblock %}
